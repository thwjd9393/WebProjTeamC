<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Male_Fashion Template">
    <meta name="keywords" content="Male_Fashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Male-Fashion | Template</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="css/menu-detail.css" type="text/css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">

    <!-- 헤더 푸터 -->
    <script src="./js/includeHTML.js"></script>

    <script>

        //주소 idx 값 얻기
        function getIdx(){
            //주소에서 카테고리 번호 가져오기
            //http://mrhisj23.dothome.co.kr/WebProjTeamC/menu-detail.html?mnuNo=14
            let mnuNoToUrl = window.location.search
            
            //번호 얻기
            let getMnuNo = mnuNoToUrl.split('=');
            let mnuNo = getMnuNo[1];

            //메뉴 상세 로드
            loadMenuDetail(mnuNo)
        }

        //메뉴 상세 로드
        function loadMenuDetail(mnuNo){

            var url=`http://mrhisj23.dothome.co.kr/WebProjTeamC/php/menuDetailLoad.php?mnuNo=${mnuNo}`;

            // 안드로이드의 레트로핏이랑 같은 아이 - 네트워크 연결
            fetch(url)
            .then(response => response.json())
            .then(data => 

                displayMenu(data)

            ).catch(error => console.log(error))

        }

        function displayMenu(data) {

            const mnuNameId = document.querySelector("#mnuName");
            const mnuContentClass = document.querySelector(".mnuContent");
            const mnuImgClass = document.querySelector(".mnuImg");
            const mnuMlClass = document.querySelector(".mnuMl");
            const mnuCalClass = document.querySelector(".mnuCal");
            const mnuSugarClass = document.querySelector(".mnuSugar");
            const mnuPrtinClass = document.querySelector(".mnuPrtin");
            const mnuFatClass = document.querySelector(".mnuFat");
            const mnuSaltClass = document.querySelector(".mnuSalt");
            

            mnuNameId.innerHTML = data.mnuName;
            mnuContentClass.innerHTML = data.mnuName;
            mnuImgClass.innerHTML = `<img src=${data.mnuImg} alt=${data.mnuName}>`;
            mnuMlClass.innerHTML = data.mnuMl;
            mnuCalClass.innerHTML = data.mnuCal;
            mnuSugarClass.innerHTML = data.mnuSugar;
            mnuPrtinClass.innerHTML = data.mnuPrtin;
            mnuFatClass.innerHTML = data.mnuFat;
            mnuSaltClass.innerHTML = data.mnuSalt;

            //리뷰 로드
            loadReviewList(data.mnuNo);

        }
        

        //리뷰 로드
        function loadReviewList(mnuNo){

            // const mnuNo = document.getElementById('mnuNo').innerHTML

            //연동할 주소
            var url=`http://mrhisj23.dothome.co.kr/WebProjTeamC/php/menuReviewSeleteAll.php?mnuNo=${mnuNo}`;

            // 안드로이드의 레트로핏이랑 같은 아이 - 네트워크 연결
            fetch(url)
            .then(response => response.json())
            .then(data => 

                //포문이 then문 안에서는 동작하지 않음
                // 그래서 외부함수에 응답받은 data 값 매개변수로 전달
                displayReviewList(data)
                // console.log(data)
            ).catch(error => console.log(error))
        }

        function displayReviewList(data) {
            const container = document.querySelector("#comtemt_item_warp")
            const reviewCnt = document.getElementById('reviewCnt')

            //코멘트 갯수
            reviewCnt.innerHTML = `<i class="bi bi-chat"></i> ${data.length}`;
            // console.log(data.length);

            data.forEach(e=> {
                
                // 1. appendChild 사용
                // const nameDiv = document.createElement('div');
                // nameDiv.className = 'reviewNic';
                // nameDiv.textContent = e.reviewNic;

                // const aa = document.createElement('a');
                // aa.className = '4444';
                // aa.textContent = e.mnuNo;

                // nameDiv.appendChild(aa);

                // const noDiv = document.createElement('div');
                // noDiv.classList.add('reviewPasswd');
                // noDiv.textContent = e.reviewPasswd;

                // container.appendChild(nameDiv);
                // container.appendChild(noDiv);

                // 2. innerHtml 사용
                // container.innerHTML = `<div class="comment_item">`;
                // container.innerHTML+= `<p class="comment">${e.reviewContent}</p>`;
                // container.innerHTML+= `<div class="d-flex justify-content-between">`;
                // container.innerHTML+= `<p id="nicname">${e.reviewNic}</p>`;
                // container.innerHTML+= `<p id="date">${e.reviewPasswd}</p>`;
                // container.innerHTML+= `</div>`;
                // container.innerHTML+= `</div>`;

                let img = (e.reviewImg).substr(1);

                container.innerHTML += `<div class="comment_item">
                        <div id="reviewNo" style="display: none;">${e.reviewNo}</div>
                        <div class="d-flex justify-content-between">
                            <p class="comment">${e.reviewContent}</p>
                            
                            <div class="reviewRight">
                                <div class="reviewBtnWarp">
                                    <span class="reViwUpdate">수정</span>
                                    <span> | </span>
                                    <span class="reViwDel">삭제</span>
                                </div>
                                <div class="reViewImg">
                                    <img src="${img}" alt="${img}">
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <p id="nicname">${e.reviewNic}</p>
                            <p id="date">${e.reviewDate}</p>
                        </div>
                    </div>`;

                
        // <div id="comtemt_item">

        // <div class="comment_item">
        //     <p class="comment">
                                            
        //     </p>
        //     <div class="d-flex justify-content-between">
        //         <p id="nicname">우리집으로가자</p>
        //         <p id="date">2023-05-17 12:23:05 </p>
        //     </div>
        // </div>

        // </div> -->

                    

            });
        }

        //선택한 파일 보이기
        function fileupload(e){
            document.getElementById('file').innerHTML=e.value;   
        }


        // 페이지 로드 시 loadMemberList 함수 호출
        window.onload = getIdx;


    </script>

    <script>

        //리뷰 쓰기
        function reViewBtn(){

            //보낼 데이터 준비
            // const reviewNic = document.getElementById('reviewNic').value;
            // const reviewPasswd = document.getElementById('reviewPasswd').value;
            // const reviewContent = document.getElementById('reviewContent').value;
            // const reviewImg = document.getElementById('reviewImg').value;
            // const mnuNo = document.getElementById('mnuNo').innerHTML;

            const reviewNicInput = document.getElementById('reviewNic');
            const reviewPasswdInput = document.getElementById('reviewPasswd');
            const reviewContentInput = document.getElementById('reviewContent');
            const reviewImgInput = document.getElementById('reviewImg');
            const mnuNoInput = document.getElementById('mnuNo');

            const reviewNic = reviewNicInput.value;
            const reviewPasswd = reviewPasswdInput.value;
            const reviewContent = reviewContentInput.value;
            const reviewImg = reviewImgInput.files[0];
            const mnuNo = mnuNoInput.innerHTML;

            // // var data="title=HELO&msg=sdsfd";
            // const data = `reviewNic=${reviewNic}&reviewPasswd=${reviewPasswd}&reviewContent=${reviewContent}&reviewImg=${reviewImg}&mnuNo=${mnuNo}`;

            const data = new FormData();
            data.append("reviewNic", reviewNic);
            data.append("reviewPasswd", reviewPasswd);
            data.append("reviewContent", reviewContent);
            data.append("reviewImg", reviewImg);
            data.append("mnuNo", mnuNo);

            //연동할 주소
            var url=`http://mrhisj23.dothome.co.kr/WebProjTeamC/php/menuReviewInsert.php`;

            // 안드로이드의 레트로핏이랑 같은 아이 - 네트워크 연결
            fetch(url,{
                    method : 'POST',
                    body : data
            }).then(response =>response.text())
            .then(data => 
                //리뷰 재로드
                reViewReload()
            ).catch(error => console.log(error))

            // fetch(url,{
            //         method : 'POST',
            //         headers : {'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'},
            //         body : data
            // }).then(response =>response.text())
            // .then(data => 
            //     //리뷰 재로드
            //     reViewReload()
            // ).catch(error => console.log(error))

        }

        //리뷰 등록 후...
        function reViewReload(){

            //텍스트 지우기
            document.getElementById('reviewNic').value = "";
            document.getElementById('reviewPasswd').value = "";
            document.getElementById('reviewContent').value = "";
            document.getElementById('reviewImg').value = "";
            document.getElementById('file').innerHTML = "";

            //기존 리스트 부시기
            const container = document.querySelector("#comtemt_item_warp");
            container.innerHTML = "";

            //리뷰 재로드
            loadReviewList()
        }

    </script>

    
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Header Section Begin -->
    <header include-html="./common/header.html" style="position: sticky; top: 0; z-index: 100;"></header>
    <!-- Header Section End -->

    <!-- Details Hero Begin -->
    <section class="blog-hero spad">
        <div class="container">
            <div class="col-lg-12 menu__title__warp">
                <h3 id="mnuName"></h3>
            </div>
        </div>
    </section>
    <!-- Details Hero End -->

    <!-- Details Section Begin -->
    <section class="blog-details spad menu__detail__contents__warp">
        <div class="container">

            <!-- 상세 정보 -->
            <div class="row">
                <div class="col-lg-6">
                    <div class="menu__detail__img text-center mnuImg">
                        
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="menu__detail__contents">
                        
                        <!-- 메뉴 설명 -->
                        <div class="menu__detail__text mnuContent">
                            
                        </div>
                        
                        <!-- 영양표시 -->
                        <div class="menu__detail__table">
                            <p>열량 및 영양성분</p>
                            <table class="table">
                                <thead>
                                  <tr>
                                    <th scope="col"></th>
                                    <th scope="col" class="text-center">R</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr>
                                    <td scope="row">1회제공량 1잔 (ml)</th>
                                    <td class="text-center mnuMl"></td>
                                  </tr>
                                  <tr>
                                    <td scope="row">열량 (kcal)</th>
                                    <td class="text-center mnuCal"></td>
                                  </tr>
                                  <tr>
                                    <td scope="row">당류 (g)</th>
                                    <td class="text-center mnuSugar"></td>
                                  </tr>
                                  <tr>
                                    <td scope="row">단백질 (g) (%영양소기준치)</th>
                                    <td class="text-center mnuPrtin"></td>
                                  </tr>
                                  <tr>
                                    <td scope="row">포화지방 (g) (%영양소기준치)</th>
                                    <td class="text-center mnuFat"></td>
                                  </tr>
                                  <tr>
                                    <td scope="row">나트륨 (mg) (%영양소기준치)</th>
                                    <td class="text-center mnuSalt"></td>
                                  </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
                
            </div>
        </div>
    </section>
    <!-- Details Section End -->


    <!-- Comments Section Begin -->
    <section class="comment__warp">
        <div class="container">

            <!-- 코멘트 -->
            <div class="row d-flex align-items-center justify-content-center">
                <div class="col-lg-8">
                    <div class="blog__details__content">
                        
                        <div class="blog__details__comment comment_content_warp">
                            <div class="d-flex">
                                <h4>Comments</h4>
                                <p id="reviewCnt"><i class="bi bi-chat"></i>0</p>
                                <!-- <p class="moreBtn" data-toggle="modal" data-target="#comentsMore"> 더보기 <i class="fa fa-chevron-right"></i></p> -->
                            </div>

                            <!-- 코멘트 -->
                            <div id="comtemt_item_warp">

                                

                            </div>
                        </div>

                        <!-- 페이지네이션 -->
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="product__pagination">
                                    <span> <i class="fa fa-caret-left"></i> </span>
                                    <a class="active" href="#">1</a>
                                    <a href="#">2</a>
                                    <span> <i class="bi bi-caret-right"></i> </span>
                                </div>
                            </div>
                        </div>
    
                        <div class="blog__details__comment mune__border">
                            <h4>Leave A Comment</h4>
                            <div class="row">
                                <div class="col-lg-6 col-md-6">
                                    <input id="reviewNic" type="text" placeholder="Name" maxlength="15">
                                </div>
                                   
                                <div class="col-lg-6 col-md-6">
                                    <input id="reviewPasswd" type="password" placeholder="Password">
                                </div>

                                <div class="col-lg-12 col-md-12">
                                    <div class="file_box">
                                        <p id="file"></p>
                                        <span class="btn_type_file">파일첨부</span>
                                        <input id="reviewImg" type="file" onchange="fileupload(this)">
                                    </div>
                                </div>

                                <div class="col-lg-12 text-center">
                                    <textarea id="reviewContent" placeholder="Comment"></textarea>
                                    <button type="button" class="site-btn" onclick="reViewBtn()">Post Comment</button>
                                </div>
                                

                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </section>
    <!-- Comments Details Section End -->

    <!-- 댓글 모달 -->
    <!-- Scrollable modal -->
    <div class="modal fade" id="comentsMore" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header justify-content-end">
                <div data-dismiss="modal" style="cursor: pointer;">x</div>
            </div>
            <div class="modal-body">
                
            </div>
            <div class="modal-footer">
              <button type="button"  class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Understood</button>
            </div>
          </div>
        </div>
    </div>

    <!-- Footer Section Begin -->
    <footer include-html="./common/footer.html"></footer>
    <!-- Footer Section End -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery.nicescroll.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
    

    <script>
        // 헤더 푸터
        includeHTML();

    </script>


</body>



</html>