<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Male_Fashion Template">
    <meta name="keywords" content="Male_Fashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Male-Fashion | Template</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <link rel="stylesheet" href="css/community-post.css" type="text/css">

    <!-- 헤더 푸터 -->

    <!-- 부트스트립 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/css/bootstrap.min.css">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha2/js/bootstrap.bundle.min.js"></script>

    <!-- JS 영역 (start) -->

    <script src="./js/community-post.js">

    </script>
    <script>

    </script>


    <script>
        // 글번호 찾아오기
        const cmtyNo = localStorage.getItem('cmtyNo');



        function loadPostList(cmtyNo) {


            // 연동할 주소
            var postUrl = `http://mrhisj23.dothome.co.kr/WebProjTeamC/php/community.php?cmtyNo=${cmtyNo}`;

            // 게시글 가져오기
            fetch(postUrl)
                .then(response => response.json())
                .then(data => {
                    // 포문이 then문 안에서는 동작하지 않음
                    // 그래서 외부함수에 응답받은 data 값 매개변수로 전달
                    postContent(data);
                    loadComment(cmtyNo); // 댓글 불러오기 함수 호출
                })
                .catch(error => console.log(error));
        }

        function postContent(data) {
            document.querySelector("#imgcontent").innerHTML = "";
            for (var i = 0; i < data.length; i++) {
                if (data[i].cmtyNo == cmtyNo) {
                    let img = data[i].cmtyImg.substr(1);

                    document.querySelector('#cmtyTitle').innerHTML = data[i].cmtyTitle;
                    document.querySelector('#cmtyPassword').innerHTML = data[i].cmtyPassword;
                    document.querySelector('#cmtyDate').innerHTML = data[i].cmtyDate;
                    document.querySelector('#cmtyNic').innerHTML = data[i].cmtyNic;
                    document.querySelector('#cmtyContent').innerHTML = data[i].cmtyContent;
                    document.querySelector("#imgcontent").innerHTML += `<img src="${img}" alt="${img}" id="img">`;
                }
            }
        }

        function loadComment(cmtyNo) {
            // 댓글 가져오기
            var commentUrl = `http://mrhisj23.dothome.co.kr/WebProjTeamC/php/communityComment.php?cmtyNo=${cmtyNo}`;

            fetch(commentUrl)
                .then(response => response.json())
                .then(data => {
                    loadCommentData(data);
                })
                .catch(error => console.log(error));
        }

        function loadCommentData(data) {
            const container = document.querySelector("#comtemt_item_warp");
            container.innerHTML = "";

            const commentCtn = document.getElementById('cmtTotal');
            commentCtn.innerHTML = "뎃글:" + data.length;

            data.forEach(e => {
                container.innerHTML += `
          <div class="comment_item" style="border: 1px solid black; margin:10px; border-radius: 32px; ">
            <div id="cmtNo" style="display: none;">${e.cmtNo}</div>
            <p class="comment" style="padding: 17px;" >${e.cmtContent}</p>
            <div class="d-flex justify-content-between">
              <p id="nicname" style="padding: 17px; margin: 5px;">${e.cmtNic}</p>
              <p id="date" style="padding: 17px; margin: 5px; ">${e.cmtDate}</p>
            </div>
          </div>
        `;
            });
        }

        window.onload = function () {
            loadPostList(cmtyNo);
        };
    </script>

    <script>
        function commentUploade() {
            const cmtNic = document.getElementById('cmtNic').value;
            const cmtPasswd = document.getElementById('cmtPasswd').value;
            const cmtContent = document.getElementById('cmtContent').value;

            // url에 집어넣을 데이터값 결합

            const data = `cmtNic=${cmtNic}&cmtPasswd=${cmtPasswd}&cmtContent=${cmtContent}&cmtyNo=${cmtyNo}`


            // 연동할 주소
            var url = `http://mrhisj23.dothome.co.kr/WebProjTeamC/php/communityCommentInsert.php`

            // 네트워크 연결
            fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
                    },
                    body: data
                }).then(response => response.text())
                .then(data =>
                    //댓글 재로드
                    CommentReload()
                ).catch(error => console.log(error))

        }


        function CommentReload() {
            //텍스트 지우기
            document.getElementById('cmtNic').value = "";
            document.getElementById('cmtPasswd').value = "";
            document.getElementById('cmtContent').value = "";

            const container = document.querySelector("#comtemt_item_warp");
            container.innerHTML = "";


            loadPostList();
        }
    </script>



    <!-- JS 영역 (end)  -->



</head>

<body>

    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Header Section Begin -->
    <header include-html="./common/header.html"></header>
    <!-- Header Section End -->

    <!-- Blog Details Hero Begin -->
    <section class="blog-hero spad">
        <div class="container">
            <div class="row d-flex justify-content-center">
                <div class="col-lg-9 text-center">

                    <!-- 본문 재목 및 닉네임 비밀번호 날자 -->
                    <div class="blog__hero__text">
                        <h2 id="cmtyTitle"></h2>
                        <div id="cmtyNo" style="display: none;"></div>
                        <ul>
                            <li id="cmtyNic"></li>
                            <li id="cmtyDate"></li>
                            <li id="cmtTotal">1</li>
                            <li id="cmtyPassword" style="display: none;">비밀번호 영역</li>
                        </ul>
                    </div>
                    <!-- 본문 재목 및 닉네임 비밀번호 날자 -->
                </div>
            </div>
        </div>
    </section>
    <!-- Blog Details Hero End -->

    <!-- Blog Details Section Begin -->
    <section class="blog-details spad">
        <div class="container">
            <div class="row d-flex justify-content-center">
                <!-- 이미지 적용 -->
                <div class="col-lg-12">

                    <div class="blog__details__pic" id="imgcontent">
                        <img src="WebProjTeamC/uploadImg/community" alt="WebProjTeamC/uploadImg/community" id="img">
                    </div>

                </div>
                <!-- 이미지 적용 -->

                <!-- 본문 내용 -->
                <div class="col-lg-12">
                    <div class="blog__details__content">

                        <div id="cmtyNo" style="display: none;"></div>

                        <div class="blog__details__text content">
                            <p id="cmtyContent"></p>

                        </div>
                        <!-- 본문 내용 -->



                        <!-- 모달 -->
                        <div class="modal fade" id="exampleModal" tabindex="1" aria-labelledby="exampleModalLabel"
                            aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <p class="modal-title" id="exampleModalLabel">비밀번호를 입력해주세요</p>
                                        <button type="button" class="btn-close" data-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form>
                                            <div class="mb-3">
                                                <label for="password" class="col-form-label">Password:</label>
                                                <input type="password" class="form-control" id="password">
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                                        <button type="button" class="btn btn-primary" id="confirmBtn">확인</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 모달 -->

                        <div class="modal fade" id="exampleModa2" tabindex="1" aria-labelledby="exampleModalLabel"
                            aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <p class="modal-title" id="exampleModalLabel">비밀번호를 입력해주세요</p>
                                        <button type="button" class="btn-close" data-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <form>
                                            <div class="mb-3">
                                                <label for="password" class="col-form-label">Password:</label>
                                                <input type="password" class="form-control" id="password">
                                            </div>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                                        <button type="button" class="btn btn-primary" id="confirmBtn">확인</button>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- 좋아요 영역(start) -->

                        <div>


                            <div class="like_holder">

                                <img src="./img/like.png" alt="like" onclick="check_ctn()">
                                <h4 id="likeCount">0</h4>

                            </div>

                        </div>



                        <!-- 좋아요 영역(end) -->

                        <div class="blog__details__option">
                            <div class="row btn_holder">
                                <div class="col-lg-6 col-md-6 col-sm-6">
                                    <div class="blog__details__author">
                                        <div class="blog__details__author__pic">

                                        </div>
                                        <div class="blog__details__author__text">

                                        </div>

                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-6">
                                    <div class="blog__details__tags ">

                                        <button type="button" class="btn btn-primary" data-toggle="modal"
                                            data-target="#exampleModal" data-whatever="@mdo" id="repost">수정</button>
                                        <script src="./js/blog-details.js"></script>

                                        <button type="button" class="btn btn-primary" data-toggle="modal"
                                            data-target="#exampleModa2" data-whatever="@mdo" id="delete">삭제</button>


                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 댓글 리스트 -->
                        <div id="comtemt_item_warp">



                        </div>
                        <!-- 댓글 리스트 -->

                        <!-- 페이지네이션 -->
                        <div class="row pdiv">
                            <div class="col-lg-12">
                                <div class="product__pagination">
                                    <a class="active" href="#">1</a>
                                    <a href="#">2</a>
                                    <a href="#">3</a>
                                    <span>...</span>
                                    <a href="#">21</a>
                                </div>
                            </div>
                        </div>
                        <!-- 페이지네이션 -->

                        <!-- comment 영역(start) -->




                        <div class="blog__details__comment">
                            <h4>댓글</h4>
                            <form action="#">
                                <div class="row">
                                    <div class="col-lg-6 col-md-6 col-sm-2">
                                        <input type="text" placeholder="닉네임" id="cmtNic">
                                    </div>

                                    <div class="col-lg-6 col-md-6 col-sm-2">
                                        <input type="password" placeholder="비밀번호" id="cmtPasswd">
                                    </div>
                                    <div class="col-lg-12 text-center">
                                        <textarea placeholder="Comment" id="cmtContent"></textarea>
                                        <button type="submit" class="submitcomment" onclick="commentUploade()">댓글
                                            작성</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <!-- comment 영역(end) -->


                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Blog Details Section End -->



    <!-- Footer Section Begin -->
    <footer include-html="./common/footer.html"></footer>
    <!-- Footer Section End -->


    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery.nicescroll.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
    <header include-html="./common/footer.html"></header>
</body>
<script>
    // // 헤더 푸터
    // includeHTML();
</script>

</html>